<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mappers.UserLogMapper">
    <insert id="setLoginDatetime" parameterType="map">
        <![CDATA[
            insert into user_log(user_id, login) values (#{username}, #{login_datetime});
        ]]>
    </insert>

    <update id="setLogoutDatetime" parameterType="map">
        <![CDATA[
            update user_log set logout = #{logout_datetime} where user_id = #{username}
        ]]>
    </update>

    <select id="getCurrentLoginUsers" resultType="string">
        <![CDATA[
            select user_id from user_log where logout is null
        ]]>
    </select>

    <select id="getAvgActiveTime" resultType="double">
        <![CDATA[
            select avg(timestampdiff(minute, login, logout)) "avg_active_time"
            from user_log where user_id = #{user_id} and logout is not null
        ]]>
    </select>
</mapper>